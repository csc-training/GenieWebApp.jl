var documenterSearchIndex = {"docs":
[{"location":"genie/testing/#Testing-Requests-with-HTTP.jl","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"","category":"section"},{"location":"genie/testing/#HTTP-Basics","page":"Testing Requests with HTTP.jl","title":"HTTP Basics","text":"","category":"section"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"As an introduction to HTTP, we recommend reading the HTTP section of Mozilla Developer Network (MDN) documentation. Especially, about the structure of HTTP messages, request methods and response status codes.","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"Let's start a Genie server on port 8000 for our application.","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"using Pkg; Pkg.activate(\".\")\nusing Genie; Genie.loadapp(); up(8000)","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"We can create requests to the server by accessing URLs in the browser. Alternatively, we can send requests directly to the server using the HTTP.jl library.","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"using HTTP\nbase = \"http://localhost:8000\"","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"The base variable should point to the base URL where we host our application, such as localhost or server where have deployed the application.","category":"page"},{"location":"genie/testing/#Views","page":"Testing Requests with HTTP.jl","title":"Views","text":"","category":"section"},{"location":"genie/testing/#Listing-All-Items","page":"Testing Requests with HTTP.jl","title":"Listing All Items","text":"","category":"section"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"By sending a GET request to the /items the server returns the HTML that shows the Items page.","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"HTTP.request(\"GET\", \"$(base)/items\")","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"HTTP.Messages.Response:\n\"\"\"\nHTTP/1.1 200 OK\nContent-Type: text/html; charset=utf-8\nServer: Genie/Julia/1.6.1\nTransfer-Encoding: chunked\n\n<!DOCTYPE html>...\"\"\"","category":"page"},{"location":"genie/testing/#Adding-New-Items","page":"Testing Requests with HTTP.jl","title":"Adding New Items","text":"","category":"section"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"warning: Warning\nCurrently, posting forms programmatically does not work for an unknown reason.","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"We can also POST forms programmatically.","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"form = HTTP.Form(Dict(\"a\"=>\"Hello World\", \"b\"=>\"1\"))\nHTTP.request(\"POST\", \"$(base)/items\", [], form)","category":"page"},{"location":"genie/testing/#API","page":"Testing Requests with HTTP.jl","title":"API","text":"","category":"section"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"We have also implemented a JSON-based API on the application on the path /api/items. The API is intended for programmatic use and access to the application. We will use the JSON3 library for encoding Julia data structures into JSON payloads.","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"using JSON3","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"Internally, a Genie application maps posted JSON objects to defined Julia data structures.","category":"page"},{"location":"genie/testing/#Retrieving-All-Items","page":"Testing Requests with HTTP.jl","title":"Retrieving All Items","text":"","category":"section"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"We can request all items from the API.","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"HTTP.request(\"GET\", \"$(base)/api/items\")","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"We receive an HTTP response with application/json content type in the header and a JSON object in the body.","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"HTTP.Messages.Response:\n\"\"\"\nHTTP/1.1 200 OK\nContent-Type: application/json; charset=utf-8\nServer: Genie/Julia/1.6.1\nTransfer-Encoding: chunked\n\n[{\"id\":{\"value\":1},\"a\":\"Hello World\",\"b\":1}]\"\"\"","category":"page"},{"location":"genie/testing/#Adding-New-Items-2","page":"Testing Requests with HTTP.jl","title":"Adding New Items","text":"","category":"section"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"We can also add new item by sending a JSON-formatted payload to the API.","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"payload = JSON3.write(Dict(:a=>\"Hello World\", :b=>1))\nHTTP.request(\"POST\", \"$(base)/api/items\",\n    [(\"Content-Type\", \"application/json\")], payload)","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"HTTP.Messages.Response:\n\"\"\"\nHTTP/1.1 201 Created\nContent-Type: application/json; charset=utf-8\nServer: Genie/Julia/1.6.1\nTransfer-Encoding: chunked\n\n\"Created\"\"\"\"","category":"page"},{"location":"genie/testing/#Retrieving-a-Specific-Item","page":"Testing Requests with HTTP.jl","title":"Retrieving a Specific Item","text":"","category":"section"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"We can query a specific item using the API.","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"HTTP.request(\"GET\", \"$(base)/api/items/1\")","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"HTTP.Messages.Response:\n\"\"\"\nHTTP/1.1 200 OK\nContent-Type: application/json; charset=utf-8\nServer: Genie/Julia/1.6.1\nTransfer-Encoding: chunked\n\n{\"id\":{\"value\":1},\"a\":\"Hello World\",\"b\":1}\"\"\"","category":"page"},{"location":"genie/testing/#Updating-a-Specific-Item","page":"Testing Requests with HTTP.jl","title":"Updating a Specific Item","text":"","category":"section"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"We can also update a specific item using the API.","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"payload = JSON3.write(Dict(:a=>\"Hello World Again\", :b=>2))\nHTTP.request(\"PUT\", \"$(base)/api/items/1\",\n    [(\"Content-Type\", \"application/json\")], payload)","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"HTTP.Messages.Response:\n\"\"\"\nHTTP/1.1 200 OK\nContent-Type: application/json; charset=utf-8\nServer: Genie/Julia/1.6.1\nTransfer-Encoding: chunked\n\n\"\"\"\"\"","category":"page"},{"location":"genie/testing/#Removing-Specific-Item","page":"Testing Requests with HTTP.jl","title":"Removing Specific Item","text":"","category":"section"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"Finally, we can remove a specific item using the API.","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"HTTP.request(\"DELETE\", \"$(base)/api/items/1\")","category":"page"},{"location":"genie/testing/","page":"Testing Requests with HTTP.jl","title":"Testing Requests with HTTP.jl","text":"HTTP.Messages.Response:\n\"\"\"\nHTTP/1.1 200 OK\nContent-Type: application/json; charset=utf-8\nServer: Genie/Julia/1.6.1\nTransfer-Encoding: chunked\n\n\"Deleted\"\"\"\"","category":"page"},{"location":"genie/development/#Developing-the-Application","page":"Developing the Application","title":"Developing the Application","text":"","category":"section"},{"location":"genie/development/#Installing-Julia-Language","page":"Developing the Application","title":"Installing Julia Language","text":"","category":"section"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"We should begin by installing Julia language from their website and add the julia binary to the path. On the project directory, we can open the Julia REPL with julia command.","category":"page"},{"location":"genie/development/#Creating-MCV-Application","page":"Developing the Application","title":"Creating MCV Application","text":"","category":"section"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"We can create a new Genie Model-View-Controller (MCV) application using Genie's generator. The structure for this application is generated as follows:","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"using Genie; Genie.newapp_mvc(\"GenieWebApp\")","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"The generator creates file structure, configurations and adds database support. We use the SQLite database for development, testing, and production.","category":"page"},{"location":"genie/development/#Running-the-Application-Locally","page":"Developing the Application","title":"Running the Application Locally","text":"","category":"section"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"We should instantiate the web application to install it locally with Julia's built-in package manager when running it for the first time.","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"using Pkg; Pkg.instantiate()","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"Then, we can activate the web application.","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"using Pkg; Pkg.activate(\".\")","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"Next, let's import Genie and use the loadapp function for developing and running the application.","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"using Genie; Genie.loadapp(\".\")","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"Now, we can use the up function to run a local web server on port 8000.","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"up(8000)","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"The local webserver should be running on http://localhost:8000/, and we can open it in the browser.","category":"page"},{"location":"genie/development/#Adding-Resources-and-Routing","page":"Developing the Application","title":"Adding Resources and Routing","text":"","category":"section"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"We can create new resources using the new_resource function. We will create a resource named Items.","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"Genie.new_resource(\"Items\")","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"The function generates three files for the Items resource to app/resources/items/ directory:","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"Items.jl contains the database models,\nItemsController.jl contains functions for handling requests by the users, and\nItemsValidator.jl handles database validation.","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"Inside Items.jl, we have created Item model, a mapping between objects in the database and Julia structs.","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"import SearchLight: AbstractModel, DbId\nimport Base: @kwdef\n\n@kwdef mutable struct Item <: AbstractModel\n  id::DbId = DbId()\n  a::String = \"\"\n  b::Int = 0\nend","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"We define routes in the routes.jl file, which are mapped to the static files in public/ and dynamic resources in app/resources/. When a server is running, making a request on a route invokes the corresponding handler function in the resources and returns a response based on its output.","category":"page"},{"location":"genie/development/#Configuring-a-Database","page":"Developing the Application","title":"Configuring a Database","text":"","category":"section"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"Genie stores database configurations to db/ directory. For example, we can add configuration for SQLite on dev environment to db/connection.yml file as follows:","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"dev:\n  adapter: SQLite\n  database: data/database.sqlite\n  host:\n  username:\n  password:\n  port:\n  config:","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"We can set up database tables if they don't exist with the following script.","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"using SearchLight\nusing SearchLightSQLite\n\n# Connect to database\nSearchLight.Configuration.load() |> SearchLight.connect\ntry\n    # Run migrations if they don't exist\n    SearchLight.Migrations.create_migrations_table()\n    SearchLight.Migrations.last_up()\ncatch\n    nothing\nend","category":"page"},{"location":"genie/development/","page":"Developing the Application","title":"Developing the Application","text":"We have added it to the global configurations, config/env/global.jl.","category":"page"},{"location":"openstack/web-user-interface/#Via-Web-User-Interface","page":"Via Web User Interface","title":"Via Web User Interface","text":"","category":"section"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"In this section, we manually configure a virtual machine, connect to it and set up a server. Manual performing these steps is an excellent way to learn how virtual machines work and understand how a web application operates from one. However, we should use containers and configuration management for deploying real production applications instead of manually deploying them.","category":"page"},{"location":"openstack/web-user-interface/#Setting-up-a-Virtual-Machine","page":"Via Web User Interface","title":"Setting up a Virtual Machine","text":"","category":"section"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Once we have access to Pouta, we should log in to the Pouta Web User Interface. Then, we can follow the instructions on launching a virtual machine in the cPouta web interface.","category":"page"},{"location":"openstack/web-user-interface/#Setting-up-SSH-Keys","page":"Via Web User Interface","title":"Setting up SSH Keys","text":"","category":"section"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"We can create SSH keys in the web interface by navigating to Compute, then Key Pairs and selecting Create Key Pair. Next, give the key pair name <keyname> and save the downloaded <keyname>.pem file to your home directory. Then, on the command line, move to the home directory, create .ssh directory with write privileges if it doesn't exist, and move your key file into it.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"cd ~\nmkdir -p .ssh\nchmod 700 .ssh\nmv <keyname>.pem .ssh","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Next, protect the key with a password and make it read-only.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"ssh-keygen -p -f .ssh/<keyname>.pem\nchmod 400 .ssh/<keyname>.pem","category":"page"},{"location":"openstack/web-user-interface/#Configuring-Security-Groups","page":"Via Web User Interface","title":"Configuring Security Groups","text":"","category":"section"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"We can manage internet access to our virtual machine by defining security groups and associating them with the virtual machine. We can set up firewalls and security groups by navigating to Network, then Security Groups. Let's create a new security group by selecting Create Security Group and name it SSH. Then, select Manage Rules for the group and Add Rule with the following parameters:","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Rule: Custom TCP Rule\nDirection: Ingress\nOpen Port: Port\nPort: 22 (Default for SSH connections.)\nRemote: CIDR\nCIDR: <ip-address>/24 (Substitute <ip-address> with your IP address which you can find out from myipaddress.com.)","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Next, let's create a security group named HTTP and add a rule with parameters.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Rule: Custom TCP Rule\nDirection: Ingress\nOpen Port: Port\nPort: 80 (Default for HTTP connections.)\nRemote: CIDR\nCIDR: 0.0.0.0/0","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Finally, let's create HTTPS security group and add the rule with parameters:","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Rule: Custom TCP Rule\nDirection: Ingress\nOpen Port: Port\nPort: 443 (Default for HTTPS connections.)\nRemote: CIDR\nCIDR: 0.0.0.0/0","category":"page"},{"location":"openstack/web-user-interface/#Launching-a-Virtual-Machine","page":"Via Web User Interface","title":"Launching a Virtual Machine","text":"","category":"section"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"We will use a virtual machine with the Ubuntu 20.04 operating system. We can launch a virtual machine by navigating to Compute, then Instances, and select Launch Instance. Set the following parameters and press Launch:","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"In the Details tab:\nAvailability Zone: nova\nInstance Name: genie\nFlavor: standard.tiny\nNumber of Instances: 1\nInstance Boot Source: Boot from image\nImage Name: Ubuntu-20.04\nIn Access & Security tab:\nKey Pair: <keyname>\nSecurity Groups: SSH, HTTP, HTTPS","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"By including the SSH security group, we can connect to our virtual machine via SSH. Furthermore, by including HTTP and HTTPS security groups, we allow traffic from the internet to the web server and application deployed on the virtual machine.","category":"page"},{"location":"openstack/web-user-interface/#Adding-a-Public-IP","page":"Via Web User Interface","title":"Adding a Public IP","text":"","category":"section"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Associating the virtual machine with a public IP allows users to connect to it with the methods we have set on the security groups. To create and associate a public IP, navigate to the menu next to Create Snapshot and select Associate Floating IP. Then, on the IP Address field, click the plus sign to allocate a new floating IP. Once allocated, select the created floating IP and press Associate. We denote the value of the floating IP as <public-ip>.","category":"page"},{"location":"openstack/web-user-interface/#Adding-Persistent-Storage","page":"Via Web User Interface","title":"Adding Persistent Storage","text":"","category":"section"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"We can also persistent storage to the virtual machine by navigating to Volumes, then Volumes, and selecting Create Volume with the following parameters:","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Volume Name: genie\nVolume Source: No source, Empty volume\nType: Standard\nSize: 1 GiB\nAvailability Zone: nova","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"From the menu next to Edit Volume, select Manage Attachments and then attach the volume to the genie virtual machine.","category":"page"},{"location":"openstack/web-user-interface/#Domain-Name","page":"Via Web User Interface","title":"Domain Name","text":"","category":"section"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"We can find out the default hostname of our virtual machine using the host command on the public IP address.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"host <public-ip>","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"15.253.214.128.in-addr.arpa domain name pointer vm3814.kaj.pouta.csc.fi.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"We can also configure our own domain name by pointing DNS records to the virtual machine IP address. You read more about DNS services in cPouta in the docs.","category":"page"},{"location":"openstack/web-user-interface/#Connecting-to-the-Virtual-Machine","page":"Via Web User Interface","title":"Connecting to the Virtual Machine","text":"","category":"section"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Now, we can connect to our virtual machine using SSH with our SSH key.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"ssh ubuntu@<public-ip> -i ~/.ssh/<keyname>.pem","category":"page"},{"location":"openstack/web-user-interface/#Attaching-the-Persistent-Volume","page":"Via Web User Interface","title":"Attaching the Persistent Volume","text":"","category":"section"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Let's begin by creating a file system on the persistent volume.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"sudo mkfs.xfs /dev/vdb","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Now can mount the persistent volume. Let's define a variable for the mount location, then create a directory to the mount location and finally mount the persistent volume to the mount location.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"VOLUME=/media/volume\nsudo mkdir -p ${VOLUME}\nsudo mount /dev/vdb ${VOLUME}","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"We also need to change the ownership of the volume to the cloud user for reading and writing data.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"sudo chown ${USER}:${USER} ${VOLUME}","category":"page"},{"location":"openstack/web-user-interface/#Installing-the-Julia-Language","page":"Via Web User Interface","title":"Installing the Julia Language","text":"","category":"section"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Once we have connected to the virtual machine via SSH, we need to install Julia language and our Genie web application using the command line. So let's begin by installing the Julia language.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"# Set URL for downloading Julia binaries\nJULIA_URL=\"https://julialang-s3.julialang.org/bin/linux/x64/1.6/julia-1.6.2-linux-x86_64.tar.gz\"\n\n# Set name for the downloaded archive\nJULIA_ARCHIVE=\"${HOME}/julia.tar.gz\"\n\n# Download the Julia language binaries\ncurl -o ${JULIA_ARCHIVE} ${JULIA_URL}\n\n# Uncompress (-z) and extract (-z) files (-f) from archive\ntar -x -z -f ${JULIA_ARCHIVE}\n\n# Remove the archive file after extraction\nrm ${JULIA_ARCHIVE}\n\n# Add symbolic link of Julia executable to /usr/bin so its found on the PATH\nsudo ln -s \"${HOME}/julia-1.6.2/bin/julia\" \"/usr/bin/julia\"","category":"page"},{"location":"openstack/web-user-interface/#Installing-the-Genie-Application","page":"Via Web User Interface","title":"Installing the Genie Application","text":"","category":"section"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Next, we can install our Genie web application from GitHub.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"GH_USER=\"jaantollander\"\nGH_REPO=\"GenieWebApp.jl\"\n\n# Clone the Genie application from the GitHub repository to HOME directory\ngit clone \"https://github.com/${GH_USER}/${GH_REPO}.git\" ${HOME}/${GH_REPO}\n\n# Define application directory\nexport GENIE_APP=\"${HOME}/${GH_REPO}\"\n\n# Change directory to GenieWebApp.jl\ncd ${GENIE_APP}\n\n# Install GenieWebApp.jl as Julia package\njulia -e \"using Pkg; Pkg.activate(\\\".\\\"); Pkg.instantiate(); Pkg.precompile(); \"\n\n# Setup Genie environment variables\nexport GENIE_ENV=\"prod\"\nexport EARLYBIND=\"true\"\n\n# Give execution privileges to `bin/server` script\nchmod +x ./bin/server","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"We should also link the data and log directories inside the Genie application to the persistent volume with symbolic links.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"sudo mkdir -p ${VOLUME}/data\nsudo ln -s ${VOLUME}/data ${GENIE_APP}/data","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"sudo mkdir -p ${VOLUME}/log\nsudo ln -s ${VOLUME}/log ${GENIE_APP}/log","category":"page"},{"location":"openstack/web-user-interface/#Running-the-Genie-Application","page":"Via Web User Interface","title":"Running the Genie Application","text":"","category":"section"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Next, we need to create a new Linux Screen for running the web server as a background process.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"screen -S genie","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Then, let's change our working directory to the Genie application directory.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"cd ${GENIE_APP}","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"We will use a reverse proxy (Nginx) to serve static files and route dynamic content to Genie server. For this reason, modify configuration settings in the production environment in config/env/prod.jl such that the Genie server does not handle static files.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"const config = Settings(\n  server_port                     = 8000,\n  server_host                     = \"0.0.0.0\",\n  log_level                       = Logging.Error,\n  log_to_file                     = true,\n  # set to false when using reverse proxy\n  server_handle_static_files      = false\n)","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"On the new screen, let's execute the./bin/server script to start a server.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"./bin/server","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"We can exit the screen by holding Ctrl and pressing a and then d key. We can retach the screen again by using the screen -r genie command if we need to.","category":"page"},{"location":"openstack/web-user-interface/#Installing-and-Configuring-Nginx-Server","page":"Via Web User Interface","title":"Installing and Configuring Nginx Server","text":"","category":"section"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"We can install Nginx on Ubuntu using the Advanced Package Tool (APT).","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"sudo apt-get update --yes\nsudo apt-get install nginx --yes\nsudo systemctl start nginx\nsudo systemctl enable nginx","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Next, we need to configure Nginx for our Genie application by creating a configuration file to the available sites directory. We can create the file using the nano editor.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"sudo nano /etc/nginx/sites-available/genie","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"On the Nano editor, add the following Nginx configurations:","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"server {\n  listen 80;\n  listen [::]:80;\n  # Use default hostname or custom domain name.\n  # `host <public-ip>`\n  server_name  vm3814.kaj.pouta.csc.fi;\n  root         /home/ubuntu/GenieWebApp.jl/public;\n  index        welcome.html;\n  # Serve static content via Nginx\n  location ~ ^/(css|img|js)/genie {\n    root /home/ubuntu/GenieWebApp.jl/public;\n  }\n  location ~ ^(error-*.html|favicon.ico|robots.txt) {\n    root /home/ubuntu/GenieWebApp.jl/public;\n  }\n  # Serve dynamic content via Genie\n  location / {\n      proxy_pass http://localhost:8000/;\n  }\n}","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Next, we enable the configuration by creating a symbolic link for the configuration file to enable the sites directory.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"sudo ln -s /etc/nginx/sites-available/genie /etc/nginx/sites-enabled/genie","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"We should also remove the default site from enabled sites.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"sudo rm -f /etc/nginx/sites-enabled/default","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Now, we can restart Nginx to make the configuration effective.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"sudo systemctl restart nginx","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"The web application should be available via HTTP.","category":"page"},{"location":"openstack/web-user-interface/#Enabling-HTTPS-with-Certbot","page":"Via Web User Interface","title":"Enabling HTTPS with Certbot","text":"","category":"section"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"We can set up HTTPS for Nginx on Ubuntu 20.04 using Certbot. Before installing Certbot, we need to ensure that we have the latest version of the Snap package manager which comes preinstalled on Ubuntu 20.04.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"sudo snap install core; sudo snap refresh core","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"We can install Certbot via Snap in classic mode.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"sudo snap install --classic certbot","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Next, we make certbot command available in the command line by creating a symbolic link of the certbot executable to /usr/bin.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"sudo ln -s /snap/bin/certbot /usr/bin/certbot","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Now, we can use Certbot to retrieve a certificate and edit our Nginx configuration, turning on HTTPS access in a single step.","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"sudo certbot --nginx","category":"page"},{"location":"openstack/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"The web application should now be available via HTTPS.","category":"page"},{"location":"openstack/command-line-interface/#Via-Command-Line-Interface","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"","category":"section"},{"location":"openshift/web-user-interface/#Via-Web-User-Interface","page":"Via Web User Interface","title":"Via Web User Interface","text":"","category":"section"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"info: Info\nThese instructions are written for Rahti with OKD3. The instructions need to be updated once OKD4 is released.","category":"page"},{"location":"openshift/web-user-interface/#Pushing-the-Docker-Image-to-Container-Registry","page":"Via Web User Interface","title":"Pushing the Docker Image to Container Registry","text":"","category":"section"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"We should log in to Rahti Container Registry, create a new project, and push the Docker image.","category":"page"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Then, we can log in on the command line using the token provided by the web client.","category":"page"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"sudo docker login -p <token> -u unused docker-registry.rahti.csc.fi","category":"page"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Next, we should tag the locally built Docker image. Substitute <name> and <tag> with the same values as for the Docker image and <project> with the name of your Rahti project.","category":"page"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"sudo docker tag <name>:<tag> docker-registry.rahti.csc.fi/<project>/<name>:<tag>","category":"page"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Now, we can push the image to the Rahti Container Registry.","category":"page"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"sudo docker push docker-registry.rahti.csc.fi/<project>/<name>:<tag>","category":"page"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"After we have uploaded the image, we are ready to deploy it.","category":"page"},{"location":"openshift/web-user-interface/#Deploying-the-Container-Image","page":"Via Web User Interface","title":"Deploying the Container Image","text":"","category":"section"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"After uploading a container image, we can log in to Rahti Web User Interface and deploy the image from the Rahti Container Registry by selecting Deploy Image, then Image Stream Tag with following parameters:","category":"page"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Namespace: <project>\nImage Stream: <name>\nTag: <tag>","category":"page"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Finally, press Deploy.","category":"page"},{"location":"openshift/web-user-interface/#Creating-a-Secure-Route","page":"Via Web User Interface","title":"Creating a Secure Route","text":"","category":"section"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"By creating a route, we can expose the application to the internet. We can create a new route by selecting Create Route with the following parameters.","category":"page"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Name: genie (Gives route a name)\nHostname: genie.rahtiapp.fi\nPath: /\nService: genie\nTarget Port: 8000 → 8000 (TCP)\nAlternate Services:\nSplit traffic across multiple services:\nSecurity: Secure route (by selecting Secure Route we enforce a secure connection via HTTPS.)\nTLS Termination: Edge\nInsecure Traffic: Redirect","category":"page"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Our application should now be available under the address https://genie.rahtiapp.fi.","category":"page"},{"location":"openshift/web-user-interface/#Setting-Up-Persistent-Storage","page":"Via Web User Interface","title":"Setting Up Persistent Storage","text":"","category":"section"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"We can set up persistent storage to data directory inside the application from Rahti Web User Interface as follows:","category":"page"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Select a project from My Projects or create a new project.\nSelect Storage and then Create Storage with the following parameters:\nStorage class: glusterfs-storage\nName: genie-volume\nAccess Mode: Shared Access (RWX)\nThen select Applications > Deployments, then your Genie application deployment. The from Actions menu, select Add Storage with the following parameters:\nStorage: genie-volume\nMount path: /home/genie/app/data","category":"page"},{"location":"openshift/web-user-interface/","page":"Via Web User Interface","title":"Via Web User Interface","text":"Application on Docker container is mounted to /home/genie/app/.","category":"page"},{"location":"","page":"Introduction","title":"Introduction","text":"CurrentModule = GenieWebApp","category":"page"},{"location":"#Introduction","page":"Introduction","title":"Introduction","text":"","category":"section"},{"location":"#Goal","page":"Introduction","title":"Goal","text":"","category":"section"},{"location":"","page":"Introduction","title":"Introduction","text":"Our goal with this repository is to demonstrate a practical, step-by-step approach for getting started with developing web applications with Julia language and Genie framework, deploying them on a cloud platform, and exposing them to users over the internet. As our deployment options, we explore traditional virtual machines and modern container platforms.","category":"page"},{"location":"","page":"Introduction","title":"Introduction","text":"We attempt to facilitate learning by first developing the web application locally, that is, on our personal computer, to demonstrate fundamental web technologies. From local development, it is easier to progress to deploying the application to the virtualized cloud environments, initially to a virtual machine and then to a container platform. Additionally, we begin by performing deployment steps manually using the web and command-line interfaces. Then, we progress towards automating them using a command-line interface and configuration management.","category":"page"},{"location":"#Why-Julia-Language?","page":"Introduction","title":"Why Julia Language?","text":"","category":"section"},{"location":"","page":"Introduction","title":"Introduction","text":"Julia language is a relatively new, general-purpose programming language designed to address challenges in technical computing such as the expression problem and the two-language problem. It addresses the expression problem using multiple-dispatch as a paradigm that enables highly expressive syntax and composable code and the two-language problem using just-in-time compilation to create high-performance code. For these reasons, the Julia language is gaining popularity in scientific computing and data analysis because it offers significant improvements in performance and composability. That is, how existing code and libraries work with one another.","category":"page"},{"location":"","page":"Introduction","title":"Introduction","text":"Traditionally, scientific computing programs run without user interaction as batch jobs on computer clusters and supercomputers. However, modern scientific computing and data analytics increasingly requires user interaction. For example, an analytics application may receive data from multiple sources over the internet, process the data, perform analysis, store results, and offer them to end-users on demand via an API. We can expose the analytics application over the internet as an on-demand service by wrapping it inside a web application or microservice and deploying it into a cloud platform. Given the advantages of the Julia language, it would be natural to develop the analytics application and the web application or microservice in Julia language.","category":"page"},{"location":"#About-Cloud-Computing","page":"Introduction","title":"About Cloud Computing","text":"","category":"section"},{"location":"","page":"Introduction","title":"Introduction","text":"For getting started with web application development and cloud computing, we assume basic knowledge of the Linux operating system, Git version control system, Julia language, and SQL databases. We recommend reading the Linux basics tutorial for understanding basic Linux command line usage. We will use the Rahti and Pouta cloud computing resources provided by CSC, the Science Center for IT in Finland. Their documentation explains the main concepts of cloud computing, such as how cloud computing differs from traditional hosted services and high-performance computing, and basic terminology such as infrastructure-, platform-, and software-as-service. If you are a part of Finnish research or higher education institutions, you can access many CSC services free of charge. If you plan to use CSC services, you can create a new project on My CSC and then apply for access to Pouta and Rahti. Otherwise, you can try a different cloud computing platform such as Amazon Web Services, Microsoft Azure, Google Cloud Platform, or Digital Ocean.","category":"page"},{"location":"#Developing-a-Genie-Application","page":"Introduction","title":"Developing a Genie Application","text":"","category":"section"},{"location":"","page":"Introduction","title":"Introduction","text":"In the Developing a Genie Application section, we explain how to create a web application with Genie framework, a full-stack Model-View-Controller (MVC) web framework similar to Ruby-on-Rails and Django. You can watch the MVC explained in 4 minutes for an overview of how they work.","category":"page"},{"location":"","page":"Introduction","title":"Introduction","text":"We will use SQLite database as a backing service in our Genie application. SQLite runs as part of the application and writes the database into a single database file to a specified location on the file system, which we should mount to persistent storage. SQLite works well for applications with small amounts of concurrent writes to the database. However, we should use a client-Server database such as PostgreSQL and MySQL if we need to perform many concurrent writes.","category":"page"},{"location":"","page":"Introduction","title":"Introduction","text":"We recommend the MDN Web Docs as a general resource about web technologies, web development, and developer tools. Especially, the sections about essential web technologies such as HTTP and HTML are helpful.","category":"page"},{"location":"","page":"Introduction","title":"Introduction","text":"Another helpful resource is the REST API Tutorial website. It covers the design principles of REST API, an extensively used architectural style for distributed hypermedia systems, for example, web applications. In practice, it defines how we can interact with the system and access resources, such as web pages or files.","category":"page"},{"location":"","page":"Introduction","title":"Introduction","text":"Furthermore, we recommend The Twelve-Factor App guidelines for an overview of best practices of developing web applications. It explains best practices for configuring and deploying applications, automating these processes, and dealing with backing services such as databases.","category":"page"},{"location":"","page":"Introduction","title":"Introduction","text":"As a side note, it is also possible to develop microservices in Julia using the Julia SDK if you want to create a lightweight, customizable, single-purpose application without a front-end.","category":"page"},{"location":"#Deploying-with-OpenStack","page":"Introduction","title":"Deploying with OpenStack","text":"","category":"section"},{"location":"","page":"Introduction","title":"Introduction","text":"In the Deploying with OpenStack section, we explain how to deploy the application manually from source to a virtual machine on the Pouta cloud service using OpenStack web interface and Linux command line on the virtual machine. We also show how to set persistent storage for the application.","category":"page"},{"location":"#Deploying-with-OpenShift","page":"Introduction","title":"Deploying with OpenShift","text":"","category":"section"},{"location":"","page":"Introduction","title":"Introduction","text":"In the Deploying with OpenShift section, we explain how to create a Docker container for the application and build and run a container image. Modern cloud architecture revolves around containers and container orchestration. We recommend reading the articles on Demystifying Containers to understand how containers work in Linux. We continue by explaining how to deploy the application's container image to the Rahti container platform using OpenShift web interface. We also show how to set persistent storage for the application.","category":"page"},{"location":"","page":"Introduction","title":"Introduction","text":"","category":"page"},{"location":"","page":"Introduction","title":"Introduction","text":"Modules = [GenieWebApp]","category":"page"},{"location":"openshift/command-line-interface/#Via-Command-Line-Interface","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"","category":"section"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"We can deploy our application via the OpenShift Command Line Interface (CLI).","category":"page"},{"location":"openshift/command-line-interface/#Installing","page":"Via Command Line Interface","title":"Installing","text":"","category":"section"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"We should begin by installing the OpenShift command line interface.","category":"page"},{"location":"openshift/command-line-interface/#Login","page":"Via Command Line Interface","title":"Login","text":"","category":"section"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"Let's login to OpenShift using the token obtained from the web interface.","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"oc login \"https://rahti.csc.fi:8443\" --token=<hidden>","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"Check OpenShift and Kubernetes versions.","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"oc version","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"oc v3.11.0+0cbc58b\nkubernetes v1.11.0+d4cacc0\nfeatures: Basic-Auth GSSAPI Kerberos SPNEGO\n\nServer https://rahti.csc.fi:8443\nopenshift v3.11.0+7876dd5-361\nkubernetes v1.11.0+d4cacc0","category":"page"},{"location":"openshift/command-line-interface/#Creating-a-Project","page":"Via Command Line Interface","title":"Creating a Project","text":"","category":"section"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"We denote the user defined parameters using variables.","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"PROJECT=\"app\"\nAPP=\"genie\"\nREPO=\"https://github.com/jaantollander/GenieWebApp.jl\"","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"We can create a new project.","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"oc new-project $PROJECT","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"If a project already exists, we can change to existing project instead.","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"oc project $PROJECT","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"We can list existing projects","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"oc projects","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"You have one project on this server: \"app\".\n\nUsing project \"app\" on server \"https://rahti.csc.fi:8443\".","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"We can show an overview of our current project.","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"oc status","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"In project app on server https://rahti.csc.fi:8443\n\nYou have no services, deployment configs, or build configs.\nRun 'oc new-app' to create an application.","category":"page"},{"location":"openshift/command-line-interface/#Deploying-the-Application","page":"Via Command Line Interface","title":"Deploying the Application","text":"","category":"section"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"Create new application, build the Docker container for the repository and deploy it to OpenShift","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"oc new-app $REPO --name=$APP","category":"page"},{"location":"openshift/command-line-interface/#Creating-a-Secure-Route","page":"Via Command Line Interface","title":"Creating a Secure Route","text":"","category":"section"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"We can expose the application to the internet by creating a route.","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"oc create route edge --service=$APP --hostname=\"$APP.rahtiapp.fi\"","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"Application should now be available in https://$APP.rahtiapp.fi.","category":"page"},{"location":"openshift/command-line-interface/#Rebuilding-Application","page":"Via Command Line Interface","title":"Rebuilding Application","text":"","category":"section"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"If we update our application and want to propagate the changes to the server, can start a new build.","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"oc start-build $APP","category":"page"},{"location":"openshift/command-line-interface/#Deleting-Application","page":"Via Command Line Interface","title":"Deleting Application","text":"","category":"section"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"After we are done with our application we can delete it.","category":"page"},{"location":"openshift/command-line-interface/","page":"Via Command Line Interface","title":"Via Command Line Interface","text":"oc delete all -l app=$APP","category":"page"},{"location":"openshift/docker-container/#Creating-a-Docker-Container","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"","category":"section"},{"location":"openshift/docker-container/#Creating-a-Dockerfile","page":"Creating a Docker Container","title":"Creating a Dockerfile","text":"","category":"section"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"Dockerfile defines how Docker builds a container image. We should also create a .dockerignore file which instructs Docker to ignore certain files such as automatically-generated files or version control (Git) files from the Docker image.","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"We use julia:1.6-buster as the base image.","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"FROM julia:1.6-buster","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"Then, we create genie user inside the container.","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"RUN useradd --create-home --shell /bin/bash genie","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"Next, we create app directory inside the /home/genie directory, copy the application files into it while ignoring files specified in .dockerignore, and change our working directory to it.","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"RUN mkdir /home/genie/app\nCOPY . /home/genie/app\nWORKDIR /home/genie/app","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"Next, we give read, write and execution permissions and change ownership to the genie user with root group for the specified files. OpenShift requires permissions for the root group.","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"RUN chgrp root /home/genie\nRUN chown genie:root -R *\nRUN chmod -R g+rw /home/genie/app\nRUN chmod g+rwX bin/server\nRUN chmod -R g+rwX /usr/local/julia","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"Now, we change the user to genie with root group.","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"USER genie:root","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"We specify environment variables for the Genie application with the ENV directive.","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"ENV JULIA_DEPOT_PATH \"/home/genie/.julia\"\nENV GENIE_ENV \"prod\"\nENV HOST \"0.0.0.0\"\nENV PORT \"8000\"\nENV EARLYBIND \"true\"","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"Now, we can install the application as a Julia package inside the container.","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"RUN julia -e \"using Pkg; Pkg.activate(\\\".\\\"); Pkg.instantiate(); Pkg.precompile(); \"","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"We can remove the Julia registries afterward to reduce the container size.","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"RUN rm -rf /genie/.julia/registries","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"We also need to give the root group execution permissions for files inside the .julia directory.","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"RUN chmod -R -f g+rwX \\\n    /home/genie/.julia/packages \\\n    /home/genie/.julia/artifacts \\\n    /home/genie/.julia/compiled \\\n    /home/genie/.julia/logs","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"We will expose the container to networking using port 8000 via TCP.","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"EXPOSE 8000/tcp","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"Finally, we set the container to execute the bin/server script to start the webserver when we run the container.","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"CMD [\"bin/server\"]","category":"page"},{"location":"openshift/docker-container/#Building-a-Docker-Image-Locally","page":"Creating a Docker Container","title":"Building a Docker Image Locally","text":"","category":"section"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"We should begin by installing Docker. Then, we can build a Docker image locally using the build command. The option -t defines the name and tag for the image. We can substitute the <name> with a name such as genie and <tag> with dev.","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"sudo docker build -t <name>:<tag> .","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"After building the image, we can run it locally with the run command. The option -p publishes the container port 8000 to host post 8000 in this order.","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"sudo docker run -it -p 8000:8000 --rm <name>:<tag>","category":"page"},{"location":"openshift/docker-container/","page":"Creating a Docker Container","title":"Creating a Docker Container","text":"The local webserver should be running on http://localhost:8000/, and we can open it in the browser.","category":"page"}]
}
