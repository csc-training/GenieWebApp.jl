<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Setting up a Virtual Machine via Command Line Interface · GenieWebApp.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://csc-training.github.io/GenieWebApp.jl/openstack/command-line-interface/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">GenieWebApp.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">About Web Technologies and Cloud Computing</a></li><li><span class="tocitem">Developing a Genie Application</span><ul><li><a class="tocitem" href="../../genie/development/">Building an MVC Application</a></li><li><a class="tocitem" href="../../genie/testing/">Testing the Application</a></li></ul></li><li><span class="tocitem">Deploying to Virtual Machine using OpenStack (v5.5)</span><ul><li><a class="tocitem" href="../web-user-interface/">Setting up a Virtual Machine via Web User Interface</a></li><li class="is-active"><a class="tocitem" href>Setting up a Virtual Machine via Command Line Interface</a><ul class="internal"><li><a class="tocitem" href="#Setting-up-the-OpenStack-Client"><span>Setting up the OpenStack Client</span></a></li><li><a class="tocitem" href="#Configuring-SSH-Keys"><span>Configuring SSH Keys</span></a></li><li><a class="tocitem" href="#Creating-a-Virtual-Machine"><span>Creating a Virtual Machine</span></a></li><li><a class="tocitem" href="#Configuring-Security-Groups"><span>Configuring Security Groups</span></a></li><li><a class="tocitem" href="#Configuring-a-Floating-IP"><span>Configuring a Floating IP</span></a></li><li><a class="tocitem" href="#Configuring-Persistent-Storage"><span>Configuring Persistent Storage</span></a></li></ul></li><li><a class="tocitem" href="../deployment/">Deploying the Application to a Virtual Machine</a></li><li><a class="tocitem" href="../deletion/">Deleting the Application and Virtual Machine</a></li></ul></li><li><span class="tocitem">Deploying to OpenShift Container Platform (v3.11)</span><ul><li><a class="tocitem" href="../../openshift/container/">Creating a Container for the Application</a></li><li><a class="tocitem" href="../../openshift/web-user-interface/">Deploying the Application via Web User Interface</a></li><li><a class="tocitem" href="../../openshift/command-line-interface/">Deploying the Application via Command Line Interface</a></li><li><a class="tocitem" href="../../openshift/deletion/">Deleting the Application</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Deploying to Virtual Machine using OpenStack (v5.5)</a></li><li class="is-active"><a href>Setting up a Virtual Machine via Command Line Interface</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Setting up a Virtual Machine via Command Line Interface</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/csc-training/GenieWebApp.jl/blob/master/docs/src/openstack/command-line-interface.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Setting-up-a-Virtual-Machine-via-Command-Line-Interface"><a class="docs-heading-anchor" href="#Setting-up-a-Virtual-Machine-via-Command-Line-Interface">Setting up a Virtual Machine via Command Line Interface</a><a id="Setting-up-a-Virtual-Machine-via-Command-Line-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-a-Virtual-Machine-via-Command-Line-Interface" title="Permalink"></a></h1><h2 id="Setting-up-the-OpenStack-Client"><a class="docs-heading-anchor" href="#Setting-up-the-OpenStack-Client">Setting up the OpenStack Client</a><a id="Setting-up-the-OpenStack-Client-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-the-OpenStack-Client" title="Permalink"></a></h2><p>We can install the OpenStack client using Python. Let&#39;s install the <a href="https://docs.conda.io/en/latest/miniconda.html">Miniconda</a> package manager which includes Python.</p><pre><code class="language-bash hljs">python --version</code></pre><pre><code class="language-text hljs">Python 3.9.1</code></pre><p>Now, we can install the client using <code>pip</code>.</p><pre><code class="language-bash hljs">pip install python-openstackclient</code></pre><p>Check your installation by calling OpenStack with version flag.</p><pre><code class="language-bash hljs">openstack --version</code></pre><pre><code class="language-text hljs">openstack 5.5.0</code></pre><p>Download <a href="https://pouta.csc.fi/dashboard/project/api_access/openrc/">RC file</a> using the Web User Interface. Then, activate the script.</p><pre><code class="language-bash hljs">source &lt;project-name&gt;-openrc.sh</code></pre><p>The prompt will ask your CSC username and password.</p><h2 id="Configuring-SSH-Keys"><a class="docs-heading-anchor" href="#Configuring-SSH-Keys">Configuring SSH Keys</a><a id="Configuring-SSH-Keys-1"></a><a class="docs-heading-anchor-permalink" href="#Configuring-SSH-Keys" title="Permalink"></a></h2><p>Create a new for your SSH key.</p><pre><code class="language-bash hljs">KEY_NAME=&quot;openstack-mydevice&quot;</code></pre><p>Create <code>.ssh</code> directory to your home directory with read and write privileges for the user.</p><pre><code class="language-bash hljs">mkdir -p ~/.ssh
chmod 700 ~/.ssh</code></pre><p>We can list files and directories on our home directory and select <code>.ssh</code> directory using the command <code>ls -la ~ | grep ssh</code>. Output should be similar to the text below.</p><pre><code class="language-text hljs">drwx------.  2 &lt;user&gt; &lt;group&gt; 4096 Aug 18 08:17 .ssh</code></pre><p>Now, we can create the key pair with OpenStack client and store it into the <code>.ssh</code> directory.</p><pre><code class="language-bash hljs">openstack keypair create $KEY_NAME &gt; ~/.ssh/$KEY_NAME.pem</code></pre><p>We should also protect the SSH key with a password.</p><pre><code class="language-bash hljs">ssh-keygen -p -f ~/.ssh/$KEY_NAME.pem</code></pre><p>Finally, change the key to read-only.</p><pre><code class="language-bash hljs">chmod 400 ~/.ssh/$KEY_NAME.pem</code></pre><p>We can verify the privileges of the key using the command <code>ls -la ~/.ssh | grep $KEY_NAME.pem</code>. Output should be similar to the text below.</p><pre><code class="language-text hljs">-r--------.  1 &lt;user&gt; &lt;group&gt; 1676 Aug 17 08:51 $KEY_NAME.pem</code></pre><h2 id="Creating-a-Virtual-Machine"><a class="docs-heading-anchor" href="#Creating-a-Virtual-Machine">Creating a Virtual Machine</a><a id="Creating-a-Virtual-Machine-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-a-Virtual-Machine" title="Permalink"></a></h2><p>To select which virtual machine we want to use, we can list the available images in YAML format as below. We use YAML format because it is easy to read and concise.</p><pre><code class="language-bash hljs">openstack image list -f yaml</code></pre><p>Similarly, we can list the available flavors.</p><pre><code class="language-bash hljs">openstack flavor list -f yaml</code></pre><p>Next, we should define a name for our virtual machine.</p><pre><code class="language-bash hljs">SERVER_NAME=&quot;genie&quot;</code></pre><p>Now, we will choose to create a virtual machine with <em>Ubuntu 20.04</em> image, with <em>standard tiny</em> flavor using the previously defined name and SSH key.</p><pre><code class="language-bash hljs">openstack server create $SERVER_NAME \
    --image=&quot;Ubuntu-20.04&quot; \
    --flavor=&quot;standard.tiny&quot; \
    --key-name=$KEY_NAME</code></pre><p>We can list all of our virtual machines as below.</p><pre><code class="language-bash hljs">openstack server list -f yaml</code></pre><h2 id="Configuring-Security-Groups"><a class="docs-heading-anchor" href="#Configuring-Security-Groups">Configuring Security Groups</a><a id="Configuring-Security-Groups-1"></a><a class="docs-heading-anchor-permalink" href="#Configuring-Security-Groups" title="Permalink"></a></h2><h3 id="Creating-SSH-Group"><a class="docs-heading-anchor" href="#Creating-SSH-Group">Creating SSH Group</a><a id="Creating-SSH-Group-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-SSH-Group" title="Permalink"></a></h3><p>We will name the SSH group <code>SSH</code>.</p><pre><code class="language-bash hljs">SSH_GROUP=&quot;SSH&quot;</code></pre><p>Now, we can create a new security group with the name.</p><pre><code class="language-bash hljs">openstack security group create $SSH_GROUP</code></pre><p>For security reasons we want that only our IP address can connect to the virtual machine with SSH. We can retrieve our IP address and bind it to a variable from the command line as follows.</p><pre><code class="language-bash hljs">REMOTE_IP=`curl https://ifconfig.me`</code></pre><p>Finally, we can add a new rule to the <code>SSH</code> security group, which allows only SSH connections from our IP address to the virtual machine.</p><pre><code class="language-bash hljs">openstack security group rule create $SSH_GROUP \
    --proto=&quot;tcp&quot; \
    --remote-ip=&quot;$REMOTE_IP/32&quot; \
    --dst-port=&quot;22&quot;</code></pre><h3 id="Creating-HTTP-Group"><a class="docs-heading-anchor" href="#Creating-HTTP-Group">Creating HTTP Group</a><a id="Creating-HTTP-Group-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-HTTP-Group" title="Permalink"></a></h3><p>We will name the HTTP group as <code>HTTP</code>.</p><pre><code class="language-bash hljs">HTTP_GROUP=&quot;HTTP&quot;</code></pre><p>Now, we can create the HTTP group.</p><pre><code class="language-bash hljs">openstack security group create $HTTP_GROUP</code></pre><p>Finally, we will add a rule that allows traffic from all IPs to the port 80, the default for HTTP traffic.</p><pre><code class="language-bash hljs">openstack security group rule create $HTTP_GROUP \
    --proto=&quot;tcp&quot; \
    --remote-ip=&quot;0.0.0.0/0&quot; \
    --dst-port=&quot;80&quot;</code></pre><h3 id="Creating-HTTPS-Group"><a class="docs-heading-anchor" href="#Creating-HTTPS-Group">Creating HTTPS Group</a><a id="Creating-HTTPS-Group-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-HTTPS-Group" title="Permalink"></a></h3><p>We will name the HTTPS group as <code>HTTPS</code>.</p><pre><code class="language-bash hljs">HTTPS_GROUP=&quot;HTTPS&quot;</code></pre><p>Now, we can create the HTTPS group.</p><pre><code class="language-bash hljs">openstack security group create $HTTPS_GROUP</code></pre><p>Finally, we will add a rule that allows traffic from all IPs to the port 443, the default for HTTPS traffic.</p><pre><code class="language-bash hljs">openstack security group rule create $HTTPS_GROUP \
    --proto=&quot;tcp&quot; \
    --remote-ip=&quot;0.0.0.0/0&quot; \
    --dst-port=&quot;443&quot;</code></pre><h3 id="Adding-Groups-to-Virtual-Machine"><a class="docs-heading-anchor" href="#Adding-Groups-to-Virtual-Machine">Adding Groups to Virtual Machine</a><a id="Adding-Groups-to-Virtual-Machine-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-Groups-to-Virtual-Machine" title="Permalink"></a></h3><p>Finally, we can add the security groups to our virtual machine.</p><pre><code class="language-bash hljs">openstack server add security group $SERVER_NAME $SSH_GROUP
openstack server add security group $SERVER_NAME $HTTP_GROUP
openstack server add security group $SERVER_NAME $HTTPS_GROUP</code></pre><h2 id="Configuring-a-Floating-IP"><a class="docs-heading-anchor" href="#Configuring-a-Floating-IP">Configuring a Floating IP</a><a id="Configuring-a-Floating-IP-1"></a><a class="docs-heading-anchor-permalink" href="#Configuring-a-Floating-IP" title="Permalink"></a></h2><p>We can create a floating IP as below.</p><pre><code class="language-bash hljs">openstack floating ip create public -f yaml</code></pre><p>The YAML formatted output will look similar to the text below.</p><pre><code class="language-yaml hljs">created_at: &#39;2021-08-18T08:22:13Z&#39;
# ...
floating_ip_address: 128.214.252.233
floating_network_id: 26f9344a-2e81-4ef5-a018-7d20cff891ee
id: 826e990f-220f-4c2c-b41a-c5205b314267
name: 128.214.252.233
# ...</code></pre><p>Alternatively, we can list all of our floating IPs.</p><pre><code class="language-bash hljs">openstack floating ip list -f yaml</code></pre><p>Output will look similar to the text below.</p><pre><code class="language-yaml hljs">- Fixed IP Address: null
  Floating IP Address: 128.214.252.233
  Floating Network: 26f9344a-2e81-4ef5-a018-7d20cff891ee
  ID: 826e990f-220f-4c2c-b41a-c5205b314267
  Port: null
  Project: 418d555e93d04a1688f305ee19d41e56</code></pre><p>Now, we can choose the created floating IP, by copying the value from the <code>floating_ip_address</code> or <code>Floating IP Address</code> field.</p><pre><code class="language-bash hljs">FLOATING_IP=&quot;128.214.252.233&quot;</code></pre><p>Finally, let&#39;s associate the floating IP with our virtual machine.</p><pre><code class="language-bash hljs">openstack server add floating ip $SERVER_NAME $FLOATING_IP</code></pre><h2 id="Configuring-Persistent-Storage"><a class="docs-heading-anchor" href="#Configuring-Persistent-Storage">Configuring Persistent Storage</a><a id="Configuring-Persistent-Storage-1"></a><a class="docs-heading-anchor-permalink" href="#Configuring-Persistent-Storage" title="Permalink"></a></h2><p>We can create a persistent storage for our virtual machine. Let&#39;s start by naming it.</p><pre><code class="language-bash hljs">VOLUME_NAME=&quot;genie-volume&quot;</code></pre><p>Now, we will create a persistent storage with size of 1 GB.</p><pre><code class="language-bash hljs">openstack volume create $VOLUME_NAME \
    --description=&quot;genie volume&quot; \
    --size=1</code></pre><p>Finally, we can attach the storage to our virtual machine.</p><pre><code class="language-bash hljs">openstack server add volume $SERVER_NAME $VOLUME_NAME</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../web-user-interface/">« Setting up a Virtual Machine via Web User Interface</a><a class="docs-footer-nextpage" href="../deployment/">Deploying the Application to a Virtual Machine »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.6 on <span class="colophon-date" title="Friday 10 September 2021 12:29">Friday 10 September 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
